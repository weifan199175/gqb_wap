$(function() {
    $(".peopleInfo .moneyBtn div").on("touchstart",function() {
        $(this).css({
            background: "#e60012",
            color: "#fff"
        }),
        $(this).siblings("div").css({
            background: "#fff",
            color: "#e60012"
        })
    }),
    $(".payMode>div").on("touchstart",function() {
        pay_type = $(this).data("paytype"),
        $(this).find(".choose").show(),
        $(this).siblings("div").find(".choose").hide()
    }),
    $("#truename").on("touchstart",function() {
    	$("div.nameError").html("&nbsp;");
    }),
    $("#message").on("touchstart",function() {
    	$("div.msgError").html("&nbsp;");
    }),
    $("#pay_Money").on("touchstart",function() {
    	$("div.moneyError").html("&nbsp;");
    }),
    $("div.moneyBtn").find("div").on("touchstart",function() {
    	$("#pay_Money").val($(this).data("money"));
    }),
    $("#readytopay").on("touchstart",function() {
    	var truename= $("#truename").val();
    	var message= $("#message").val();
		var lastmoney = $("#price").val()-$("#total_price").val();//剩余需要支付的金额
		var pay_Money = $("#pay_Money").val();

		if(!truename){
			$("div.nameError").html("请填写您的姓名");return;
		}
		if(!message){
			$("div.msgError").html("请完善您的留言");return;
		}
		if(!isPositiveInteger(pay_Money)){
			$("div.moneyError").html("支付金额必须是正整数");
			$("#pay_Money").val("");
			return;
		}
		
		if(pay_Money>lastmoney){
			$("div.moneyError").html("支付金额不能大于所需金额");
			$("#pay_Money").val(lastmoney);
			return;
		}

		var data = new Object();
		data['message'] = $("#message").val();
		data['money'] = pay_Money;
		data['pay_type'] = pay_type;
		data['truename'] = $("#truename").val();
		data['fid'] = $("#funding_id").val();
		var url = '/index.php/Content/WeixinPay/confirm_zcorder';
		l_waiting();
		$.ajax({
			url:url,
			type:"POST",
			data:data,
			timeout:15000,
			dataType:"json",
			success:function(r){
				l_done();
				if(r.code == 0){
				     if(data['pay_type'] == "weixin"){
				    	 requestParam=JSON.parse(r.jsApiParameters);
				    	 pay();
				     }else if(data['pay_type'] == "zhifubao"){
					     window.location.href=r.url;
				     }
				}else {
					alert(r.errormsg);
			   	}
			},
			error:function(){
				l_done();
				alert(data.errormsg);
			}
		})	
	})
});